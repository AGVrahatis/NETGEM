digraph factorial
{
    rankdir=TB;
    subgraph cluster_prior {
	label="Prior";
	style=filled;
	color=pink;
	T [label="Theta"];
    }
    subgraph cluster_param {
	label="Parameter";
	style=filled;
	color=lightblue;
	Qa [label="Q1"];
	Qb [label="Q2"];
    }
    subgraph cluster_visible {	
	rankdir=LR; 
        label="observed";
	color=lightgrey;	
        subgraph clusterta {
	  
	    labelpos=B;
	    "X0" [
		shape="record"
		label=" | <f1> i | ... | <f2> j | ... |<f3> k |...|<f4> l |" 
		];	    
	    style=filled;
	    label="X(t)";
	}
	subgraph clustertb {
	    label="X(t+1)";
	    style=filled;
            X1 [
		shape="record"
		label=" | <f1> i | ... | <f2> j | ... |<f3> k | ...|<f4> l |" 
		];	    
	    }
    }
   subgraph cluster_hidden {
       label="hidden";
       style=filled;
       subgraph cluster_edgeA {
	    rankdir=TB;
	    style=filled;
	    color=grey;
	    label="e_a=(i, j)";
	    W0 [label="w_a(t)", shape=box];
	    W1 [label="w_a(t+1)", shape=box];
	    W0 -> W1;
	}
	subgraph cluster_edgeB {
	    rankdir=TB;
	    style=filled;
	    color=grey;
	    label="e_b=(i, k)";
	    W2 [label="w_b(t)", shape=box];
	    W3 [label="w_b(t+1)", shape=box];
	    W2 -> W3;
	}
	subgraph cluster_edgeC {
	    rankdir=TB;
	    style=filled;
	    color=grey;
	    label="e_c=(k, l)";
	    W4 [label="w_c(t)", shape=box];
	    W5 [label="w_c(t+1)", shape=box];
	    W4 -> W5;
	}

}
    T -> Qa;
    T -> Qb;
    Qa -> W1 [color=red];
    Qb -> W3 [color=red];
    Qa -> W5 [color=red];
    W0 -> "X0":f1;
    W1 -> "X1":f1;  
    W0 -> "X0":f2;
    W1 -> "X1":f2;
    W2 -> "X0":f1;
    W2 -> "X0":f3;
    W3 -> "X1":f1;
    W3 -> "X1":f3;
    W4 -> "X0":f4;
    W4 -> "X0":f3;
    W5 -> "X1":f4;
    W5 -> "X1":f3;
    
};
    